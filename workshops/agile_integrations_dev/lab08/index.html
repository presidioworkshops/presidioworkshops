<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Lab 08 - API Consumption | Presidio Workshops</title>

    
    
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly.min.css" />
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly-additions.min.css" />

    
    <link rel="stylesheet" href="/node_modules/highlight.js/styles/darkula.css" />

    
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/asciidoc.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    
    <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery/dist/jquery.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/c3/c3.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/d3/d3.min.js"></script>

    
    
    <script src="/node_modules/patternfly/node_modules/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/drmonty-datatables-colvis/js/dataTables.colVis.js"></script>
    <script src="/node_modules/patternfly/node_modules/datatables.net-colreorder/js/dataTables.colReorder.js"></script>

    
    
    <script src="/node_modules/patternfly/dist/js/patternfly.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-combobox/js/bootstrap-combobox.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/moment/min/moment.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-select/dist/js/bootstrap-select.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-treeview/dist/bootstrap-treeview.min.js"></script>

    
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery-match-height/dist/jquery.matchHeight-min.js"></script>
    
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/clip.js"></script>
    
    <script src="/node_modules/highlight.js/lib/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body class="">
    

<nav class="navbar navbar-default navbar-inverse navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
     <a class="navbar-brand" href="/">
      <img src="img/presidio-white.png" width="150" height="auto">
      
      </a>
    </div>
    <div class="collapse navbar-collapse navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        
        
          
            <li>
              <a href="/">Home</a>
            </li>
          
        
          
            <li>
              <a href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a href="/contact/">Contact</a>
            </li>
          
        
          
            <li>
              <a href="/events/">Events</a>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Workshops <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/agile_integrations_ci/">Agile Integrations Workshop - Citizen Integrator</a>
                  </li>
                
                  <li>
                    <a href="/workshops/agile_integrations_dev/">Agile Integrations Workshop - Developer</a>
                  </li>
                
                  <li>
                    <a href="/workshops/automation/">Automation Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/cloudforms41/">CloudForms Workshops</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_containers/">Container Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/containers_101/">Containers 101 Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/secure_software_factory/">DevSecOps Workshop - Secure Software Factory</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_kubernetes/">Kubernetes Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/kubernetes_101/">Kubernetes Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/strangling_the_monolith/">Monolith to Microservices Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/net_automation_101/">Network Automation 101 Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/selinux_policy/">SELinux Policy Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/source_to_image/">Source to Image</a>
                  </li>
                
              </ul>
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>



<div class="jumbotron jumbotron-page text-center">
  <h1>Lab 08 - API Consumption</h1>
</div>

<div class="container">
  <div class="row">
    <p class="text-center">
      
      <a href="http://presidioworkshops.com/workshops/agile_integrations_dev">Return to Workshop</a>
    </p>
    
    








<nav>
  <ul class="pager">
    
    
    <li class="previous">
      <a href="http://presidioworkshops.com/workshops/agile_integrations_dev/lab07/">&larr; Previous: Lab 07 - API Developer Portal</a>
    </li>
    
    
    
    
    
  </ul>
</nav>

    <h1 id="lab-8">Lab 8</h1>
<h2 id="api-consumption">API Consumption</h2>
<h3 id="connect-applications-and-apis">Connect Applications and APIs</h3>
<ul>
<li>Duration: 15 mins</li>
<li>Audience: API Consumers, Developers, Architects</li>
</ul>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/agenda-05.png &ldquo;Login&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="overview">Overview</h3>
<p>APIs provide the building blocks for applications, but it is applications which deliver functionality to the end users. hence to see APIs in action it helps to see how applications can call APIs to provide new functionality. In this lab you&rsquo;ll be able to create a simple web application which consumes the API you built earlier in the exercises.</p>
<h3 id="why-red-hat">Why Red Hat?</h3>
<p>Applications can be built from many technologies. In this case we use a simple web application, but a wide range of Red Hat and non-Red Hat technologies could be used.</p>
<h2 id="lab-instructions">Lab Instructions</h2>
<h3 id="update-openshift-deployment">Update OpenShift Deployment</h3>
<p>OpenShift let you automatically redeploy your changes when you setup a Continuous Integration / Continuous Deployment (CI/CD) pipeline through the use of webhook. For this lab we will trigger the new build and deployment manually through the OpenShift Console.</p>
<ol>
<li>
<p>Go back to your OpenShift web console. Navigate to your project&rsquo;s overview page.</p>
</li>
<li>
<p>Scroll down and click in the www link in the BUILDS section.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/deploy-10.png&quot; &ldquo;Scroll Down&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
<li>
<p>In the build environment variables page, replace the <code>CLIENT_ID</code> from <code>CHANGE_ME</code> to the one generated from the previous lab.</p>
</li>
</ol>
<ul>
<li>
<p>Also, make note of the API_BACKEND_URL.  That is the 3Scale backend address of your API.  If the 3Scale Environment is configured with self-signed certificates, go ahead and bring up that link in a Browser and have your Browser accept the certificate for later on. 3Scale should give you an authentication error since it&rsquo;s not configured yet.  The important thing is to just accept the certificate.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/deploy-11.png&quot; &ldquo;Change Client ID&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ul>
<ol>
<li>
<p>Click Save button to persist the changes. A green pop up will show you that the changes were saved.</p>
</li>
<li>
<p>Click the Start Build button to trigger a new build using the new environment variables pointing to your service.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/deploy-12.png &ldquo;Start Build&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
<li>
<p>In the Overview Page, a new build will be triggered. Expand the row by clicking the Builds Icon.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/deploy-13.png &ldquo;View Build&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ol>
<p><em>The build process checks out the code from the git repo, runs a source-to-image container image build, and redeploys the container with the new image using a rolling upgrade strategy.</em></p>
<ol>
<li>
<p>Wait for until the new Build to complete and the rolling upgrade to finish to test your new deployment.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/consume-22.png &ldquo;Updated App&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ol>
<h3 id="update-secured-service-with-red-hat-single-sign-on-application-callback">Update Secured Service with Red Hat Single Sign On Application Callback</h3>
<p>Redirect URLs are a critical part of the OAuth flow. After a user successfully authorizes an application, the authorization server will redirect the user back to the application with either an authorization code or access token in the URL. Because the redirect URL will contain sensitive information, it is critical that the service doesn’t redirect the user to arbitrary locations.</p>
<ol>
<li>
<p>Open a browser window and navigate to your SSO Console.  Please check with your instructor for the link.  It should be similar to the following.  Replace userX with your assigned user and OCP_URL.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">http://sso-sso.apps.<span style="color:#f92672">[</span>OCP_URL<span style="color:#f92672">]</span>/auth/admin/<span style="color:#f92672">[</span>userX<span style="color:#f92672">]</span>/console/
</code></pre></div><p><em>Remember to replace the X with your user number.</em></p>
</li>
<li>
<p>Log into Red Hat Single Sign On using your designated user and password. Click on <strong>Sign In</strong>.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/00-login-sso.png &ldquo;RH SSO Login&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
<li>
<p>Select <strong>Clients</strong> from the left menu.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/00-clients.png &ldquo;Clients&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><em>3scale, through it&rsquo;s <a href="https://github.com/3scale/zync/">zync</a> component, already synchronized the application information into the Red Hat SSO security realm</em>.</p>
</li>
<li>
<p>Click on the <strong>CLIENT_ID</strong> link to view the details.</p>
<p><em>Remember to select correct CLIENT_ID with the one you got in the <a href="../lab07">API Security Lab</a>. It will easily identifiable as its and hexadecimal name</em>.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/consume-24.png &ldquo;Client Application&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
<li>
<p>Scroll down, type in and select the following options in the application configuration below.  Please make sure to use the Redirect URI for your user.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access Type</td>
<td>Public</td>
</tr>
<tr>
<td>Standard Flow Enabled</td>
<td>ON</td>
</tr>
<tr>
<td>Implicit Flow Enabled</td>
<td>OFF</td>
</tr>
<tr>
<td>Valid Redirect URIs</td>
<td><a href="http://www-userX.apps">http://www-userX.apps</a>.[OCP_URL]/*</td>
</tr>
<tr>
<td>Web Origins</td>
<td>*</td>
</tr>
</tbody>
</table>
<p><em>Remember to replace the X with your user number.</em></p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/consume-25.png &ldquo;Client Configuration&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
<li>
<p>Finally, click <strong>Save</strong> button to persist the changes.</p>
</li>
</ol>
<h3 id="test-the-single-sign-on-integration">Test the Single Sign On Integration</h3>
<ol>
<li>Open a Private Browser tab and navigate to your SSO Location App.  Update userX and OCP_URL :</li>
</ol>
<ul>
<li><code>http://www-userX.apps.[OCP_URL]/</code>.</li>
<li><em>Remember to replace the X your user number.</em></li>
</ul>
<ol>
<li>
<p>Navigate to the Locations Page</p>
</li>
<li>
<p>Click the <strong>Sign In</strong> button.</p>
</li>
<li>
<p>You are being redirected to Red Hat Single Sign On <strong>Login Page</strong>. Login using the user credentials you created in the <a href="../lab04/#step-2-add-user-to-realm">API Security Lab</a></p>
<ul>
<li>Username: <strong>userX</strong></li>
<li>Password: <strong>password you received from instructor</strong></li>
</ul>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/consume-23.png &ldquo;Login Realm&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
<li>
<p>You will be redirected again to the <strong>LOCATIONS</strong> page where now you will be able to see the map with the International Inc Offices.</p>
<p><!-- raw HTML omitted -->&lt;img src=&quot;../images/consume-14.png &ldquo;Locations Page&rdquo; width=&ldquo;900&rdquo; /&gt;<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ol>
<p><em>Congratulations!</em> You have successfully used the Keycloak Javascript Adapter to protect International Inc&rsquo;s Locations Service with Single Sign On.  If you have any issues, please see the next session.</p>
<h3 id="troubleshooting-the-locations-page">Troubleshooting the Locations Page</h3>
<ol>
<li>
<p>In most cases, the Locations web page will <strong>NOT</strong> show the locations because of a self-signed certificate issue in your web-browser.</p>
</li>
<li>
<p>To resolve this issue in Chrome, navigate to More Tools &gt; Developer Tools* menu.  A Developer Tools console should appear.</p>
</li>
<li>
<p>In the developer console, a red error should appear indicating a cert issue. Click on the link and accept the certificate.</p>
</li>
<li>
<p>Refresh the page, and the locations should appear.</p>
</li>
<li>
<p>If you get an &ldquo;Authentication Parameter is Missing&rdquo; Error.  It&rsquo;s most likely your backend api is not working</p>
<ul>
<li>Make you created the location-service API from Lab 3</li>
<li>Go into 3Scale and update the Private Base URL for the SSO Locations API to a working API such as the sample Locations API that your instructor can give you.</li>
</ul>
</li>
<li>
<p>Also, make sure to use an Incognito Browser Window or Clear your Browser Cache when viewing the International Sample Application</p>
</li>
<li>
<p>Also you can try relaxing your browser security settings.  In Settings &gt; Advanced &gt; Privacy and Security &gt; Protect you and your device from dangerous sites</p>
</li>
</ol>
<ul>
<li>Turn that option to off</li>
<li>Make sure to turn this setting back on after the lab</li>
</ul>
<h2 id="steps-beyond">Steps Beyond</h2>
<p>So, you want more? You can explore in detail the documentation on the Javascript Adapter to check what other things can you get from your authenticated user.</p>
<h2 id="summary">Summary</h2>
<p>In total you should now have been able to follow all the steps from designing and API, deploying it&rsquo;s code, issuing keys, connecting OpenID connect and calling it from an application. This gives you a brief overview of the creation and deployment of an API. There are many variations and extensions of these general principles to explore!</p>
<h2 id="notes-and-further-reading">Notes and Further Reading</h2>
<ul>
<li><a href="http://microcks.github.io/">Red Hat 3scale API Management</a></li>
<li><a href="https://developers.redhat.com/blog/2017/11/21/setup-3scale-openid-connect-oidc-integration-rh-sso/">Setup OIDC with 3scale</a></li>
</ul>


    








<nav>
  <ul class="pager">
    
    
    <li class="previous">
      <a href="http://presidioworkshops.com/workshops/agile_integrations_dev/lab07/">&larr; Previous: Lab 07 - API Developer Portal</a>
    </li>
    
    
    
    
    
  </ul>
</nav>

    <p class="text-center">
      
      <a href="http://presidioworkshops.com/workshops/agile_integrations_dev">Return to Workshop</a>
    </p>
  </div>
</div>

    <div id="page-footer" class="container">
      <p class="text-center">
        Copyright &copy; 2024 Presidio, Inc.
      </p>
    </div>
    <script type="text/javascript">
      if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
      }
    </script>
  </body>
</html>

