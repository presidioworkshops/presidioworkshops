<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Exercise 1.17 - Introduction to the Automate Datastore | Presidio Workshops</title>

    
    
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly.min.css" />
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly-additions.min.css" />

    
    <link rel="stylesheet" href="/node_modules/highlight.js/styles/darkula.css" />

    
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/asciidoc.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    
    <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery/dist/jquery.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/c3/c3.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/d3/d3.min.js"></script>

    
    
    <script src="/node_modules/patternfly/node_modules/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/drmonty-datatables-colvis/js/dataTables.colVis.js"></script>
    <script src="/node_modules/patternfly/node_modules/datatables.net-colreorder/js/dataTables.colReorder.js"></script>

    
    
    <script src="/node_modules/patternfly/dist/js/patternfly.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-combobox/js/bootstrap-combobox.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/moment/min/moment.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-select/dist/js/bootstrap-select.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-treeview/dist/bootstrap-treeview.min.js"></script>

    
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery-match-height/dist/jquery.matchHeight-min.js"></script>
    
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/clip.js"></script>
    
    <script src="/node_modules/highlight.js/lib/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body class="">
    

<nav class="navbar navbar-default navbar-inverse navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
     <a class="navbar-brand" href="/">
      <img src="img/presidio-white.png" width="150" height="auto">
      
      </a>
    </div>
    <div class="collapse navbar-collapse navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        
        
          
            <li>
              <a href="/">Home</a>
            </li>
          
        
          
            <li>
              <a href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a href="/contact/">Contact</a>
            </li>
          
        
          
            <li>
              <a href="/events/">Events</a>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Workshops <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/agile_integrations_ci/">Agile Integrations Workshop - Citizen Integrator</a>
                  </li>
                
                  <li>
                    <a href="/workshops/agile_integrations_dev/">Agile Integrations Workshop - Developer</a>
                  </li>
                
                  <li>
                    <a href="/workshops/automation/">Automation Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/cloudforms41/">CloudForms Workshops</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_containers/">Container Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/containers_101/">Containers 101 Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/secure_software_factory/">DevSecOps Workshop - Secure Software Factory</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_kubernetes/">Kubernetes Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/kubernetes_101/">Kubernetes Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/strangling_the_monolith/">Monolith to Microservices Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/net_automation_101/">Network Automation 101 Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/selinux_policy/">SELinux Policy Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/source_to_image/">Source to Image</a>
                  </li>
                
              </ul>
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>



<div class="jumbotron jumbotron-page text-center">
  <h1>Exercise 1.17 - Introduction to the Automate Datastore</h1>
</div>

<div class="container">
  <div class="row">
    <p class="text-center">
      
      <a href="http://presidioworkshops.com/workshops/cloudforms41">Return to Workshop</a>
    </p>
    
    








<nav>
  <ul class="pager">
    
    
    <li class="previous">
      <a href="http://presidioworkshops.com/workshops/cloudforms41/exercise1.16/">&larr; Previous: Exercise 1.16 - Explore Containers</a>
    </li>
    
    
    
    
    <li class="next">
      <a href="http://presidioworkshops.com/workshops/cloudforms41/exercise1.18/">Next: Exercise 1.18 - “Hello, World!” Automation Script &rarr;</a>
    </li>
    
    
  </ul>
</nav>

    <h1 id="exercise-117---introduction-to-the-automate-datastore">Exercise 1.17 - Introduction to the Automate Datastore</h1>
<h2 id="exercise-description">Exercise Description</h2>
<p>In this exercise, you will learn about scripting actions, used to control automation datastore functions.</p>
<p>When we use the Automate capability of CloudForms, we write scripts in the Ruby language and use objects that the CloudForms Automation Engine makes available to us. The Automate model is arranged to provide an object oriented hierarchy to control automation functions. The model uses the following organizational units arranged in a hierarchy:</p>
<ul>
<li><strong>Datastore</strong> - The main organization unit that stores the entire model.</li>
<li><strong>Domains</strong> - Domains act as collection of automation functions. Functions are executed depending on the order of Domain priority, which means a function in a Domain with a higher priority overrides the same functions specified in a lower-priority Domain. This allows CloudForms Management Engine to specify a core Domain (ManageIQ) but allow users to override automate functions with custom Domains. Each Domain contains a set of Namespaces.</li>
<li><strong>Namespaces</strong> - Containers that organize and categorize functions of the model. Namespaces can contain child Namespaces as well as Classes.</li>
<li><strong>Classes</strong> - Templates for a specific function of the model. Each Class uses a Schema to apply to Instances to populate with default values. Each class also can contain a set of methods.</li>
<li><strong>Instances</strong> - An instance is a version of a class populated with initial configuration data. An instance can include a collection of any number of attributes, calls to methods, and relationships.</li>
<li><strong>Methods</strong> - Methods are functions within the model. Methods use Ruby code to execute various operations needed for a Class.</li>
</ul>
<h2 id="section-1-exploring-automate">Section 1: Exploring Automate</h2>
<p>Go to <strong>Automate</strong> → <strong>Explorer</strong>.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
<em>Automate Navigation</em></p>
<p>The first menu item that we see takes us to the Explorer.  This is our visual interface into the Automate Datastore, and it contains the various kinds of Automate objects that we’ll use throughout this lab.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
<em>Automate Explorer</em></p>
<p>Before we start our journey into learning CloudForms Automate, we’ll take a tour of the Automate Datastore to familiarize ourselves with the objects that we’ll find there.</p>
<h2 id="section-2-the-automate-datastore">Section 2: The Automate Datastore</h2>
<p>The Automate Datastore has a directory-like structure, consisting of several types of organizational units arranged in a hierarchy:</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
<em>Automate Datastore</em></p>
<p>Next, we’ll look at each type of object in more detail.</p>
<h2 id="section-3-domains">Section 3: Domains</h2>
<p>A <em>domain</em> is a collection of namespaces, classes, instances, and methods. The ManageIQ project provides a single <em>ManageIQ</em> domain for all supplied automation code, while Red Hat adds the supplemental RedHat domain containing added-value code for the CloudForms product.  Both the <em>ManageIQ</em> and <em>RedHat</em> domains are locked, indicating their read-only nature, but we can create new domains for our own custom automation code.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
Organizing our own code into custom domains greatly simplifies the task of exporting and importing code (simplifying code portability and reuse).  It also leaves ManageIQ or Red Hat free to update the locked domains through minor releases without fear of overwriting our customizations.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapsecf99377f914f58a20dcefaf1bc8ab983&quot; class=&quot;collapsed&quot;&gt;
  
    Domain Priority
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;p&gt;User-added domains can be individually enabled or disabled and can be ordered by priority such that if code exists in the same path in multiple domain; for example, &lt;em&gt;/Cloud/VM/Provisioning/StateMachines&lt;/em&gt;.  The code in the highest-priority enabled domain will be executed.&lt;/p&gt;
</code></pre>
<!-- raw HTML omitted -->
<pre><code>&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapsec7415b44347a4a2e6907ac4a3984a364&quot; class=&quot;collapsed&quot;&gt;
  
    Importing/Exporting Domains
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;p&gt;We can export domains using rake from the command line and import them either using rake or from the WebUI.  Using rake enables us to specify more import and export options.  A typical rake import line is as follows:&lt;/p&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapse428b759075fcfef686132a1a6defd5d6&quot; class=&quot;collapsed&quot;&gt;
  
    Copying Objects Between Domains
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;h4 id=&quot;customizing-code-in-the-domain&quot;&gt;Customizing code in the domain&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<pre><code>&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapsef36e230838639eac66c1886ce90ef582&quot; class=&quot;collapsed&quot;&gt;
  
    Importing Old Format Exports
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;p&gt;Domains were a new feature of the Automate Datastore in CloudForms 3.1.  All factory-supplied and user-created automation code was contained in a common structure prior to the CloudForms 3.1 release.  This made updates difficult when any user-added code was introduced.  User-supplied modifications needed to be exported and reimported/merged whenever an automation update was released.&lt;/p&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="section-4-namespaces">Section 4: Namespaces</h2>
<p>A <em>namespace</em> is a folder-like container for classes, instances, and methods, and is used purely for organizational purposes.  We create namespaces to arrange our code logically, and namespaces often contain other namespaces.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
<em>Namespaces</em></p>
<h2 id="section-5-classes">Section 5: Classes</h2>
<p>A <em>class</em> is similar to a template: it contains a generic definition for a set of automation operations.  Each class has a <em>schema</em> that defines the variables, states, relationships, or methods that instances of the class will use.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
The Automate Datastore uses object-oriented terminology for these objects.  A <em>class</em> is a generic definition for a set of automation operations, and these classes are <em>instantiated</em> as specific instances.</p>
<p>The classes that we work with in the Automate Datastore are not the same as Ruby classes that we work with in our automation scripts.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapse6b52be40f2e5ec2927b4112533d2613b&quot; class=&quot;collapsed&quot;&gt;
  
    Schemas
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;p&gt;A &lt;em&gt;schema&lt;/em&gt; is made up of a number of elements, or &lt;em&gt;fields&lt;/em&gt;, that describe the properties of the class.  A schema often has just one entry—to run a single method—but in many cases it has several components.  The following shows the schema for a &lt;em&gt;placement&lt;/em&gt; class, which has several different field types.&lt;/p&gt;
</code></pre>
<!-- raw HTML omitted -->
<pre><code>&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapse23b0f0f9d8042d569b3eb475085d5f7a&quot; class=&quot;collapsed&quot;&gt;
  
    Adding or Editing a Schema
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;blockquote&gt;
</code></pre>
<!-- raw HTML omitted -->
<pre><code>&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;a data-toggle=&quot;collapse&quot; href=&quot;#collapse3338c5f270c978376fb50d13856dd152&quot; class=&quot;collapsed&quot;&gt;
  
    Relationships
  &lt;/a&gt;
&lt;/h4&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>&lt;div class=&quot;panel-body&quot;&gt;
   &lt;p&gt;One of the schema field types is a &lt;em&gt;relationship&lt;/em&gt;, which links to other instances elsewhere in the Automate Datastore.  We often use relationships as a way of chaining instances together, and relationship values can accept variable substitutions for flexibility.&lt;/p&gt;
</code></pre>
<!-- raw HTML omitted -->
<pre><code>&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="section-6-instances">Section 6. Instances</h2>
<p>An <em>instance</em> is a specific <em>instantiation</em> or “clone” of the generic class and is the entity run by the Automation Engine.  An instance contains a copy of the class schema but with actual values of the fields filled in.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted -->
<em>Single class definition with three instances</em></p>
<h2 id="section-7-methods">Section 7. Methods</h2>
<p>A <em>method</em> is a self-contained block of Ruby code that gets executed when we run any automation operation.  A typical method looks like this:</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e">#</span>
<span style="color:#75715e"># Description: This method checks to see if the VM has been powered off or suspended.</span>
<span style="color:#75715e">#</span>

<span style="color:#75715e"># Get vm from root object</span>
vm <span style="color:#f92672">=</span> $evm<span style="color:#f92672">.</span>root<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;vm&#39;</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">if</span> vm
  power_state <span style="color:#f92672">=</span> vm<span style="color:#f92672">.</span>attributes<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;power_state&#39;</span><span style="color:#f92672">]</span>
  ems <span style="color:#f92672">=</span> vm<span style="color:#f92672">.</span>ext_management_system
  $evm<span style="color:#f92672">.</span>log(<span style="color:#e6db74">&#39;info&#39;</span>, <span style="color:#e6db74">&#34;VM:&lt;</span><span style="color:#e6db74">#{</span>vm<span style="color:#f92672">.</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&gt; on provider:&lt;</span><span style="color:#e6db74">#{</span>ems<span style="color:#f92672">.</span>try(<span style="color:#e6db74">:name</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74"> has Power \
</span><span style="color:#e6db74">           State:&lt;</span><span style="color:#e6db74">#{</span>power_state<span style="color:#e6db74">}</span><span style="color:#e6db74">&gt;&#34;</span>)

  <span style="color:#75715e"># If VM is powered off or suspended exit</span>
  <span style="color:#66d9ef">if</span> <span style="color:#e6db74">%w(off suspended)</span><span style="color:#f92672">.</span>include?(power_state)
    <span style="color:#75715e"># Bump State</span>
    $evm<span style="color:#f92672">.</span>root<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ae_result&#39;</span><span style="color:#f92672">]</span>         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ok&#39;</span>
  <span style="color:#66d9ef">elsif</span> power_state <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;never&#34;</span>
    <span style="color:#75715e"># If never then this VM is a template so exit the retirement state machine</span>
    $evm<span style="color:#f92672">.</span>root<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ae_result&#39;</span><span style="color:#f92672">]</span>         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;error&#39;</span>
  <span style="color:#66d9ef">else</span>
    $evm<span style="color:#f92672">.</span>root<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ae_result&#39;</span><span style="color:#f92672">]</span>         <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;retry&#39;</span>
    $evm<span style="color:#f92672">.</span>root<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ae_retry_interval&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;60.seconds&#39;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Methods can have one of three <em>location</em> values: <em>inline</em>, <em>built-in</em>, or <em>URI</em>.  In practice most of the methods that we create are inline methods, which means they run as a separate Ruby process outside of Rails.</p>
<h2 id="summary">Summary</h2>
<p>In this lab exercise we’ve learned about the fundamental objects or organizational units that we work with in the Automate Datastore: domains, namespaces, classes, instances, and methods.</p>
<p>We are now ready to use this information to write our first automation script!</p>


    








<nav>
  <ul class="pager">
    
    
    <li class="previous">
      <a href="http://presidioworkshops.com/workshops/cloudforms41/exercise1.16/">&larr; Previous: Exercise 1.16 - Explore Containers</a>
    </li>
    
    
    
    
    <li class="next">
      <a href="http://presidioworkshops.com/workshops/cloudforms41/exercise1.18/">Next: Exercise 1.18 - “Hello, World!” Automation Script &rarr;</a>
    </li>
    
    
  </ul>
</nav>

    <p class="text-center">
      
      <a href="http://presidioworkshops.com/workshops/cloudforms41">Return to Workshop</a>
    </p>
  </div>
</div>

    <div id="page-footer" class="container">
      <p class="text-center">
        Copyright &copy; 2024 Presidio, Inc.
      </p>
    </div>
    <script type="text/javascript">
      if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
      }
    </script>
  </body>
</html>

